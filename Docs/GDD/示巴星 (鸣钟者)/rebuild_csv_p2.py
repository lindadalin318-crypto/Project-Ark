#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""Part2: ACT2 (50:00-90:00) with NPC Lyra direct interaction + Ripple as independent tool + World Clock foreshadowing"""
import os

CSV = os.path.join(os.path.dirname(os.path.abspath(__file__)), "关卡心流与节奏控制-2.csv")

with open(CSV, 'r', encoding='utf-8') as f:
    existing = f.read().rstrip('\n')

L = []
def r(s=""): L.append(s)

r("")
r(",,,,,,,,")
r("========== ACT 2: 叹息的峡谷 (50:00-90:00) ==========,,,,,,,,")
r("时长约40分钟 | Z2叹息峡谷 | 环境解谜+涟漪获取+新敌人类型+NPC缕拉首次面对面,,,,,,,,")
r("叙事弧：噪音制造者→获得倾听工具(涟漪)→第一次试图沟通→NPC从敌意到初步信任 | 世界时钟微弱预兆,,,,,,,,")
r(",,,,,,,,")
r("时段 (Time),区域 (Zone)(Asset),乐章 (Beat)(Narrative),张力(1-10),核心目标 (Objective)(UI Guide),核心障碍 (Obstacle)(The Problem),关键获取 (Acquisition)(The Solution),能力验证 (Verification)(The Test),地图关键点 (POIs)(System/Secret)")

# Z2a - NPC: distant aid during combat
r('"50:00-60:00 (600s)","Z2a. 管风琴走廊 (Linear→Multi-path)","第三乐章：深渊 (Mvt III: The Abyss)",5,"穿越管风琴走廊/新敌人类型","[环境] 巨大的管风琴管道形成自然走廊。管道口吹出周期性强风——需要利用间隙前进。[敌人] 首次SH-M04共振尖叫者(远程+升调预警)。SH-M01x4+SH-M04x2组合——远近配合。[机制] 管风琴管道可被射击→产生不同音高的冲击波——击退怪物或制造临时掩体。[高潮] 走廊中段被大量爬行者包围。快要被淹没时——远处传来一段高频旋律所有爬行者瞬间停顿2秒(被镇静)。玩家获得喘息窗口。[NPC·缕拉远程援助] 旋律来源无法确认但守夜人记录到熟悉的频率信号:是之前那个淡金色鸣钟者。","[无新获取] 管风琴环境交互教学","【验证】1.管风琴强风周期:吹3秒→停2秒 2.尖叫者升调预警→侧闪2秒窗口 3.射击管道→不同音高冲击波 4.利用冲击波击退怪群 5.被包围→远处旋律→爬行者停顿2秒 6.守夜人:又是那个信号...它救了我们? 7.走廊尽头→峡谷全景展开 8.伊恩:它一直在跟着我们","[教学] 尖叫者预警系统 [NPC] 缕拉远程援助(高频旋律镇静爬行者2秒) [环境] 管风琴管道可交互 [叙事] N-03:峡谷深处的光 [氛围] 管风琴低频共鸣BGM"')

# Z2b - Ripple as independent tool + NPC first face-to-face
r('"60:00-70:00 (600s)","Z2b. 声之走廊 (Puzzle→Exploration)","第三乐章：聆听 (Mvt III: Listening)",3,"获取涟漪/发现它是探索工具/NPC缕拉首次面对面","[引导] 走廊深处有一面巨大的克拉德尼壁画——但是破碎的。需要用特定频率修复。[精英] SH-E01金色指挥者守护壁画。击败→壁画背后密室打开→涟漪(声波弹)核心。[涟漪获取教学] 涟漪是独立快捷交互工具(长按专用键发射环境声波)。不占用主武器/副武器槽位。它是探索工具而非第三把枪。教学:1.长按键→发射声波脉冲 2.声波脉冲击中壁画→修复裂痕+显现图案 3.声波脉冲击中黑水→净化一小片 4.声波脉冲推开物理碎片→露出隐藏通道。[NPC·缕拉首次面对面] 涟漪教学后在隐藏房间中发现缕拉正在修复一面壁画。她听到玩家→身体赤红(恐惧)后退。守夜人翻译:又一个噪音制造者...不要靠近我的花...。[互动选择] A.用涟漪射击附近水晶→和谐音调→缕拉变翠绿(好奇)小心靠近 B.用实弹→缕拉尖叫逃走(此次失败但后续重接触)。选A:缕拉用旋律回应涟漪声波→两种声波交织产生和弦。守夜人:她在和你说话。这个声音不痛。缕拉留下淡金色频率标记在玩家身上(持续到ACT2结束)。","[星核] 涟漪(声波弹) 独立交互工具(非武器槽位) 长按专用键发射 功能:解密/推物/显形/净化","【验证】1.壁画线索→需要频率修复 2.精英守护→击败解锁密室 3.涟漪获取→独立键位教学(非武器槽) 4.长按发射→声波脉冲扩散 5.修复壁画(解密验证) 6.净化黑水(净化验证) 7.推开碎片(物理验证) 8.NPC缕拉首次面对面→选择A/B 9.选A→和弦共鸣→频率标记buff 10.涟漪是探索工具不是武器","[星核获取] 涟漪/声波弹(独立交互工具) [NPC] 缕拉首次面对面(赤红→翠绿) [教学] 涟漪四大功能:解密/推物/显形/净化 [设计关键] 独立快捷键不占武器槽位 [Lore] 壁画内容=大静默前的世界 [精英] SH-E01金色指挥者"')

# Z2c - Lyra frequency mark effect + world clock foreshadowing
r('"70:00-80:00 (600s)","Z2c. 叹息深谷 (Traversal+Combat)","第四乐章：信号 (Mvt IV: Signal)",5,"穿越深谷/体验涟漪实战/世界时钟预兆","[环境] 峡谷深处。黑水沼泽+悬浮晶体平台——需涟漪显形隐藏平台。[敌人] SH-S01坚盾歌者首次出现(钟形正面盾/反弹子弹)。需要:A.绕背射击 B.涟漪穿透盾牌。SH-M01x6+SH-S01x2组合。[NPC效果] 缕拉的频率标记(如果获得)→某些歌唱型爬行者SH-M03看到金色标记后不逃跑反而靠近跟随(微弱护盾buff)。这是缕拉的介绍信——她告诉歌唱者:这个噪音制造者可能不是坏人。[世界时钟微弱预兆] 峡谷中一种奇怪的现象:每隔约90秒黑水沼泽会整体短暂退潮(5秒)→露出沼泽底部的通道和物品→然后再次涨潮淹没。守夜人:有意思...这里似乎有某种节律。像呼吸。伊恩:这个星球还活着?","[无新获取] 涟漪实战验证。坚盾歌者教学。","【验证】1.隐形平台→涟漪显形3秒 2.坚盾歌者正面反弹→需绕背或涟漪 3.涟漪穿透盾→坚盾歌者硬直1秒 4.频率标记→歌唱者跟随(可选buff) 5.黑水退潮→短暂露出底部(世界时钟预兆) 6.守夜人:某种节律...像呼吸 7.涟漪净化黑水→开辟短暂通路 8.退潮时可拾取隐藏道具","[教学] 坚盾歌者应对策略 [NPC效果] 频率标记→歌唱者跟随buff [世界时钟伏笔] 黑水退潮节律=潮汐预兆 [环境] 隐形平台+黑水沼泽 [涟漪实战] 显形/穿盾/净化三合一 [叙事] 星球节律暗示"')

# Z2d - Boss + more world clock foreshadowing
r('"80:00-90:00 (600s)","Z2d. 叹息墙Boss战 (Boss Arena)","第四乐章：突破 (Mvt IV: Breakthrough)",9,"击败叹息墙之心SH-B01/获取反弹棱镜","[Boss] 叹息墙之心SH-B01。峡谷出口被巨大活体水晶墙封死。P1:晶体盾阶段——墙面射出晶体矛+从裂缝渗出黑水。需涟漪净化黑水+实弹射击暴露的核心。P2:黑水涌动——核心暴露但大量SH-M01+SH-M05静默腐化者涌出。火力压制同时保护自己。P3:狂暴——墙体碎裂释放静音力场(热量自动上升!)→必须在过热前打完。[世界时钟互动] Boss战中峡谷潮汐更明显:涨潮时黑水上涌Boss回血缓慢/退潮时黑水退去核心完全暴露(DPS窗口)。守夜人:利用退潮的时机!这是此后世界时钟机制的预演。[NPC·缕拉] Boss战后：峡谷出口打开广阔回音平原展开。远处高崖上缕拉在观望。如果玩家在Z2b成功互动:缕拉身体闪琥珀色(信任)→缓缓飘向ACT3区域方向。如果未互动:缕拉仍保持距离但没有逃走。","[棱镜] 流变棱镜·反弹(2013) Boss掉落 利用峡谷反弹特性","【验证】1.P1晶体矛→走位+涟漪净化黑水 2.核心暴露→集中火力5秒 3.P2黑水涌出+腐化者→火力优先级判断 4.P3静音力场→热量管理压力 5.涨潮/退潮节奏→DPS窗口利用(世界时钟预演) 6.守夜人提示潮汐节奏 7.击败→墙体崩碎→峡谷出口 8.棱镜获取+安装 9.反弹效果→峡谷墙壁验证 10.NPC缕拉远处观望(琥珀色=信任建立中)","[Boss] SH-B01叹息墙之心(三阶段) [棱镜获取] 流变棱镜·反弹 [世界时钟预演] 涨潮/退潮节奏→DPS窗口 [NPC] 缕拉远处观望→ACT3衔接 [叙事] N-05:峡谷另一边的世界 [过渡] 回音平原全景→ACT3预告 [设计意图] Boss战中学会利用潮汐=ACT3的伏笔教学"')

r(",,,,,,,,")
r("ACT2 心流曲线(40min):,,,,,,,,")
r("  50:00  █████░░░░░ 5/10 [深渊] 新敌人+管风琴环境+NPC缕拉远程援助,,,,,,,,")
r("  60:00  ███░░░░░░░ 3/10 [聆听] 涟漪获取(独立交互工具教学)+NPC缕拉首次面对面,,,,,,,,")
r("  70:00  █████░░░░░ 5/10 [信号] 涟漪实战+频率标记buff+世界时钟潮汐预兆,,,,,,,,")
r("  80:00  █████████░ 9/10 [突破] Boss战+世界时钟DPS窗口预演+反弹棱镜,,,,,,,,")
r("ACT2总结:获得涟漪(独立探索工具)。NPC缕拉从恐惧戒备→初步信任(频率标记)。世界时钟以潮汐预兆形式铺垫。,,,,,,,,")

with open(CSV, 'w', encoding='utf-8') as f:
    f.write(existing + "\n".join(L) + "\n")
print(f"Part2 OK: added {len(L)} rows")
